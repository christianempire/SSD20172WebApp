var simulations=[],currentSimulation={},firstSimulationExecuted=!1,currentSimulationSaved=!1,baseUrl="http://52.226.131.0/api-arena/",getSimpleSimulationPayload=function(){return{numExpertAgents:$("#numexp").val(),numNewAgents:$("#numnew").val()}},getAdvancedSimulationPayload=function(){return{numExpertAgents:$("#numexp").val(),numNewAgents:$("#numnew").val(),totalServiceDuration:$("#TAM").val(),agentLunchDuration:$("#TR").val(),minAgentsDuringLunch:$("#minage").val(),meanArrivalTime:$("#TLP").val(),lowerTransferTime:$("#TTPI").val(),upperTransferTime:$("#TTPF").val(),expertAgentMeanServiceDuration:$("#TAE").val(),newAgentMeanServiceDuration:$("#TAN").val()}},saveSimulation=function(){if(!jQuery.isEmptyObject(currentSimulation)){delete currentSimulation.simulationId;delete currentSimulation.createdOn;for(var n=0;n<currentSimulation.agent.length;n++)agent=currentSimulation.agent[n],delete agent.agentId,delete agent.simulationId,delete agent.simulation;(currentSimulation.description=$("#simulation-name").val(),currentSimulation.description!=="")&&$.ajax({url:baseUrl+"simulations/",data:JSON.stringify(currentSimulation),method:"POST",headers:{"Content-type":"application/json"},beforeSend:function(){swal({title:'<img src="/images/100.GIF" />',text:"Guardando escenario...",allowOutsideClick:!1,showConfirmButton:!1})},success:function(){$("#main-modal").modal("hide");currentSimulationSaved=!0;$("#simulation-name").val("");swal("Éxito","Escenario guardado correctamente.","success")},error:function(n){swal("Error","El escenario no pudo guardarse debido a un error inesperado.","error");console.log(n)}})}},updateAndShowSimulations=function(){$.ajax({url:baseUrl+"simulations/",method:"GET",beforeSend:function(){swal({title:'<img src="/images/100.GIF" />',text:"Obteniendo escenarios...",allowOutsideClick:!1,showConfirmButton:!1})},success:function(n){Array.isArray(n)?(swal.close(),simulations=n,updateCasesModalTable(),n.length>0?showModalCases():swal("No hay escenarios","Actualmente no hay escenarios disponibles para mostrar.","info")):swal("Error","Los escenarios no pudieron obtenerse debido a un error inesperado.","error")},error:function(n){swal("Error","Los escenarios no pudieron obtenerse debido a un error inesperado.","error");console.log(n)}})},deleteSimulation=function(n){swal({title:"Confirmación",text:"Una vez eliminado el registro no se podrá recuperar. ¿Seguro que desea eliminarlo?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí",cancelButtonText:"No"}).then(t=>{t.value&&$.ajax({url:baseUrl+"simulations/"+n,method:"DELETE",beforeSend:function(){swal({title:'<img src="/images/100.GIF" />',text:"Eliminando escenario...",allowOutsideClick:!1,showConfirmButton:!1})},success:function(){for(var t=0,i=!1;!i&&t<simulations.length;)simulations[t].simulationId===n?i=!0:t++;i&&(simulations.splice(t,1),updateCasesModalTable(),simulations.length===0&&$("#main-modal").modal("hide"));swal("Éxito","Escenario eliminado correctamente.","success")},error:function(n){swal("Error","El escenario no pudo eliminarse debido a un error inesperado.","error");console.log(n)}})})},showModalWelcome=function(){$("#header-modal-welcome").show();$("#body-modal-welcome").show();$("#footer-modal-welcome").show();$("#header-modal-manual").hide();$("#body-modal-manual").hide();$("#footer-modal-manual").hide();$("#header-modal-save").hide();$("#body-modal-save").hide();$("#footer-modal-save").hide();$("#header-modal-cases").hide();$("#body-modal-cases").hide();$("#footer-modal-cases").hide();$("#main-modal").modal("show")},showModalManual=function(){$("#header-modal-welcome").hide();$("#body-modal-welcome").hide();$("#footer-modal-welcome").hide();$("#header-modal-manual").show();$("#body-modal-manual").show();$("#footer-modal-manual").show();$("#header-modal-save").hide();$("#body-modal-save").hide();$("#footer-modal-save").hide();$("#header-modal-cases").hide();$("#body-modal-cases").hide();$("#footer-modal-cases").hide();$("#main-modal").modal("show")},showModalSave=function(){$("#header-modal-welcome").hide();$("#body-modal-welcome").hide();$("#footer-modal-welcome").hide();$("#header-modal-manual").hide();$("#body-modal-manual").hide();$("#footer-modal-manual").hide();$("#header-modal-save").show();$("#body-modal-save").show();$("#footer-modal-save").show();$("#header-modal-cases").hide();$("#body-modal-cases").hide();$("#footer-modal-cases").hide();$("#main-modal").modal("show")},showModalCases=function(){$("#header-modal-welcome").hide();$("#body-modal-welcome").hide();$("#footer-modal-welcome").hide();$("#header-modal-manual").hide();$("#body-modal-manual").hide();$("#footer-modal-manual").hide();$("#header-modal-save").hide();$("#body-modal-save").hide();$("#footer-modal-save").hide();$("#header-modal-cases").show();$("#body-modal-cases").show();$("#footer-modal-cases").show();$("#main-modal").modal("show")},changeSimulationType=function(){$("#select-types").val()=="simple"?$("#form-advanced").hide():$("#select-types").val()=="advanced"&&$("#form-advanced").show()};$(".only-number").keydown(function(n){$.inArray(n.keyCode,[46,8,9,27,13,110,190])!==-1||n.keyCode===65&&(n.ctrlKey===!0||n.metaKey===!0)||n.keyCode>=35&&n.keyCode<=40||(n.shiftKey||n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.preventDefault()});var attemptOpenSaveModal=function(){firstSimulationExecuted?currentSimulationSaved?swal("Escenario ya guardado","El escenario ya se encuentra guardado. Ejecute otro para volver a usar esta opción.","info"):showModalSave():swal("Escenario no ejecutado","Debe ejecutar un escenario antes de usar esta opción.","info")},updateCasesModalTable=function(){var t,i,n;for($("#cases-table-body").html(""),t=JSON.parse(JSON.stringify(simulations)),i="",n=0;n<t.length;n++)simulation=t[n],simulation.createdOn=simulation.createdOn.split("T")[0],i+=Mustache.render($("#case-row-template").html(),simulation);$("#cases-table-body").html(i)},seeCaseDetails=function(n){for(var f=!1,i=0,r,t,u,e,o;!f&&i<simulations.length;)simulations[i].simulationId===n?(r=simulations[i],f=!0):i++;if(f){for(t=JSON.parse(JSON.stringify(r)),t.numExpertAgents=0,t.numNewAgents=0,u=0;u<r.agent.length;u++)e=r.agent[u],e.isExpert?t.numExpertAgents+=1:t.numNewAgents+=1;o=Mustache.render($("#case-details-template").html(),t);$("#case-details-table-body").html(o);$("#secondary-modal").modal("show")}};