@{
    ViewData["Title"] = "Simulación Aeropuerto";
}

<div id="home" class="container-fluid">
  <div class="row heading">
    <div class="col-sm-12 col-md-8 title" align="left">
      <h1>Sistema de Soporte de Decisiones</h1>
    </div>
    <div class="col-sm-12 col-md-4 logo" align="right">
      <img src="http://www.ulima.edu.pe/sites/all/themes/ulima/logo.png" />
    </div>
  </div>
  <div class="row simulation-form">
    <div id="form-simple">
      <div class="form-group col-xd-12 col-sm-4 col-md-2">
        <div class="fieldset">
          <label>Modo</label>
          <select id="select-types" class="form-control" onchange="changeSimulationType()">
            <option value="simple">Simple</option>
            <option value="advanced">Avanzado</option>
          </select>
        </div>
      </div>
      <div class="form-group col-xd-12 col-sm-4 col-md-2">
        <div class="fieldset">
          <label>Agentes expertos</label>
          <input id="numexp" class="form-control only-number" placeholder="Ingrese número de agentes expertos">
        </div>
        <div class="fieldset">
          <label>Agentes nuevos</label>
          <input id="numnew" class="form-control only-number" placeholder="Ingrese número de agentes nuevos">
        </div>
      </div>
    </div>
    <div id="form-advanced" style="display: none;">
      <div class="form-group col-xd-12 col-sm-4 col-md-2">
        <div class="fieldset">
          <label>Minimo número de agentes atendiendo durante refrigerio</label>
          <input id="minage" class="form-control only-number" placeholder="Ingrese el mínimo de agentes">
        </div>
        <div class="fieldset">
          <label>Tiempo de refrigerio (horas)</label>
          <input id="TR" class="form-control only-number" placeholder="Ingrese el tiempo de refrigerio">
        </div>
      </div>
      <div class="form-group col-xd-12 col-sm-4 col-md-2">
        <div class="fieldset">
          <label>Tiempo de atención - agente experto (minutos)</label>
          <input id="TAE" class="form-control only-number" placeholder="Ingrese el tiempo de atención">
        </div>
        <div class="fieldset">
          <label>Tiempo de atención - agente nuevo (minutos)</label>
          <input id="TAN" class="form-control only-number" placeholder="Ingrese el tiempo de atención">
        </div>
      </div>
      <div class="form-group col-xd-12 col-sm-4 col-md-2">
        <div class="fieldset">
          <label>Tiempo de llegada de pasajeros (minutos)</label>
          <input id="TLP" class="form-control only-number" placeholder="Ingrese el tiempo de llegada de pasajeros">
        </div>
        <div class="fieldset">
          <label>Tiempo de traslado de pasajeros (minutos)</label>
          <div>
            <input id="TTPI" style="width: 49%; float: left;" class="form-control only-number" placeholder="Inicio">
            <input id="TTPF" style="width: 49%; float: right;" class="form-control only-number" placeholder="Fin">
          </div>
        </div>
      </div>
      <div class="form-group col-xd-12 col-sm-4 col-md-2">
        <div class="fieldset">
          <label>Tiempo de atención del mostrador (horas)</label>
          <input id="TAM" class="form-control only-number" placeholder="Ingrese el tiempo de atención del mostrador">
        </div>
      </div>
    </div>
  </div>
  <div class="row options">
    <div class="col-xs-12 col-sm-8 col-md-4">
      <button id="button-manual" type="button" class="btn" onclick="showModalManual()">
        <span class="glyphicon glyphicon-book"></span> Ver manual
      </button>
      <button id="button-execute" type="button" class="btn" onclick="execute()">
        <span class="glyphicon glyphicon glyphicon-ok"></span> Ejecutar
      </button>
      <button id="button-save" type="button" class="btn" onclick="save()">
        <span class="glyphicon glyphicon-floppy-disk"></span> Guardar
      </button>
      <button id="button-cases" type="button" class="btn" onclick="showModalCases()">
        <span class="glyphicon glyphicon-search"></span> Ver escenarios
      </button>
    </div>
  </div>
  <div id="divrecomendation" class="row" style="display:none; margin-top: 2%">
    <div id="alertR" class="alert alert-success" role="alert" style="margin-left: 15px;margin-right: 15px;margin-bottom: 0px;">
      <label>Se recomienda ...</label>
    </div>
  </div>
  <div id="divResult" class="row" style="display:none; margin-top: 2%">
    <div class="col-md-12">
      <div id="piechart_div" style="display: inline-block;"></div>
      <div id="barchart_div" style="display: inline-block;"></div>
      <table id="tabresult" style="width:auto;display: inline-block;background: white;margin-bottom: 181px;" class="table table-hover table-responsive">
        <thead>
        <th>Otros datos</th>
        <th></th>
        </thead>
        <tbody id="tabdetail">
          <tr>
            <td>Tamaño promedio de cola</td>
            <td>0</td>
          </tr>

          <tr>
            <td>Tamaño máximo de la cola</td>
            <td>0</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Main Modal -->
<div class="modal fade" id="main-modal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- Headers -->
      <div class="modal-header" id="header-modal-manual">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Manual de usuario</h3>
      </div>
      <div class="modal-header" id="header-modal-welcome">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Bienvenido(a)</h3>
      </div>
      <div class="modal-header" id="header-modal-cases">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Lista de escenarios</h3>
      </div>
      <!-- /.headers -->
      <!-- Bodies -->
      <div class="modal-body" id="body-modal-manual">
        <div id="maunal-carousel" class="carousel slide" data-ride="carousel" data-interval="false">
          <!-- Indicators -->
          <ol class="carousel-indicators">
            <li data-target="#maunal-carousel" data-slide-to="0" class="active"></li>
            <li data-target="#maunal-carousel" data-slide-to="1"></li>
          </ol>
          <!-- Wrapper for slides -->
          <div class="carousel-inner">
            <div class="item active">
              <img src="~/images/manual-1.png" />
            </div>
            <div class="item">
              <img src="~/images/manual-2.png" />
            </div>
          </div>
          <!-- Left and right controls -->
          <a class="left carousel-control" href="#maunal-carousel" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="right carousel-control" href="#maunal-carousel" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
      <div class="modal-body" id="body-modal-cases">
        <table class="table table-hover" style="width:100%" id="tabody-modal-cases">
          <thead>
          <th>Nombre del escenario</th>
          <th>Acciones</th>
          </thead>
          <tbody>
            <tr id="c1" class="">
              <td>Caso 15 agentes</td>
              <td>
                <button id="bsc1" type="button" onclick="selectCase('bsc1')" class="btn btn-default case" aria-label="Left Align">
                  <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                </button>
                <button id="bec1" type="button" onclick="eliminate('c1')" class="btn btn-default" aria-label="Left Align">
                  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                </button>
                <button id="bdc1" type="button" onclick="seeDetails('c1')" class="btn btn-default" aria-label="Left Align">
                  <span class="glyphicon glyphicon-list" aria-hidden="true"></span>
                </button>
              </td>
            </tr>
            <tr id="c2" class="">
              <td>Caso 10 agentes</td>
              <td>
                <button type="button" id="bsc2" class="btn btn-default case" onclick="selectCase('bsc2');" aria-label="Left Align">
                  <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                </button>
                <button id="bec2" type="button" onclick="eliminate('c2')" class="btn btn-default" aria-label="Left Align">
                  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                </button>
                <button id="bdc2" type="button" onclick="seeDetails('c2')" class="btn btn-default" aria-label="Left Align">
                  <span class="glyphicon glyphicon-list" aria-hidden="true"></span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-body" id="body-modal-welcome">
        <p><b>Facultad:</b> Ingeniería</p>
        <p><b>Curso:</b> Sistema de Soporte de decisiones</p>
        <p><b>Ciclo:</b> 2017-2</p>
        <p><b>Integrantes:</b></p>
        <table>
          <tbody id="tabody-modal-welcome">
            <tr><td>Cabrera Diaz, Daniel</td><td>20131642</td></tr>
            <tr><td>Changa Castillo, Christian</td><td>20143344</td></tr>
            <tr><td>Dextre Porras, Anthony</td><td>20111763</td></tr>
            <tr><td>Li Morante, Jazmín</td><td>20141941</td></tr>
            <tr><td>Martínez Vélez, Carlos</td><td>20122872</td></tr>
            <tr><td>Morillo Palacios, Bruna</td><td>20142059</td></tr>
          </tbody>
        </table>
      </div>
      <!-- /.bodies -->
      <!-- Footers -->
      <div class="modal-footer" id="footer-modal-welcome">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
      <div class="modal-footer" id="footer-modal-cases">
        <button type="button" class="btn btn-success" onclick="seeChanges()" data-dismiss="modal">Mostrar seleccionado(s)</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
      <!-- /.footers -->
    </div>
  </div>
</div>

<!-- Secondary Modal -->
<div class="modal fade" id="modalDtl" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header" id="header-modal-manual" style="background: #6bc4e6">
        <h3 class="modal-title col-md-11" style="color:white"> <b>Detalles</b></h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body col-md-12" id="body-modal-welcome">
        <table style="width:100%" class="table table-hover">
          <tbody id="tabdetail">
            <tr>
              <td>Agentes expertos</td>
              <td>2</td>
            </tr>
            <tr>
              <td>Agentes nuevos</td>
              <td>2</td>
            </tr>
            <tr>
              <td>Turno de agentes</td>
              <td>2</td>
            </tr>
            <tr>
              <td>Tiempo de refrigerio</td>
              <td>2</td>
            <tr>
              <td>Tiempo de atención - agente experto</td>
              <td>2</td>
            </tr>
            <tr>
              <td>Tiempo de atención - agente nuevo</td>
              <td>2</td>
            </tr>
            <tr>
              <td>Tiempo de atención del mostrador</td>
              <td>2</td>
            </tr>
            <tr>
              <td>Tiempo de atención del traslado de pasajeros - inicio</td>
              <td>2</td>
            </tr>
            <tr>
              <td>Tiempo de atención del traslado de pasajeros - fin</td>
              <td>2</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer" id="fdetail">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<button id="buttonSaveModal" type="button" style="display: none;" class="btn btn-info btn-lg" data-toggle="modal" data-target="#saveModal">Open Modal</button>
<div id="saveModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background: #6bc4e6">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" style="color: white">Modal Header</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <input id="modeldescription" type="text" class="form-control" placeholder="Escriba un nombre para el modelo" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="$('#buttonSaveModal').trigger('click')" data-dismiss="modal">Guardar</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

@section Scripts {
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    var simulationResults;

    //Variables generales
    var listSelected;

    var execute = function () {

      var payload = {}
      if ($("#select-types").val() === "simple") {
        payload = getSimpleSimulationPayload();
      }
      else if ($("#select-types").val() === "advanced") {
        payload = getAdvancedSimulationPayload();
      }
      else {
        return;
      }
      $.ajax({
        url: baseUrl + "run/" + $("#select-types").val(),
        data: payload,
        method: "GET",
        success: function (response) {
          console.log(response);
          if (response !== null && response !== "" && response.status !== 400) {
            simulationResults = response;
            drawChart();
            $("#tabdetail").html('<tr><td> Tamaño promedio de cola</td><td>' + simulationResults.avgNumberInQueue + '</td></tr><tr><td>Tamaño máximo de la cola</td><td>' + simulationResults.maxNumberInQueue + '</td></tr>');
            $("#divResult").show();
            $("#divrecomendation").show();
          }
        },
        error: function (xhr) {
          console.log(xhr);
        }
      });

    };

    function drawChart() {

      var datapie = new google.visualization.DataTable();
      datapie.addColumn('string', 'Topping');
      datapie.addColumn('number', 'Slices');
      if (simulationResults && typeof simulationResults !== "undefined") {
        rows = [];
        contExp = 1;
        contNue = 1;
        for (var i = 0; i < simulationResults.agent.length; i++) {
          agent = simulationResults.agent[i];
          if (agent.isExpert) {
            rows.push(['E' + contExp, agent.utilization]);
            contExp++;
          }
          else {
            rows.push(['N' + contNue, agent.utilization]);
            contNue++;
          }
        }
        datapie.addRows(rows);
      } else {
        datapie.addRows([
          ['Agentes expertos', 1],
          ['Agentes nuevos', 1],
        ]);
      }

      var piechart_options = {
        title: 'Utilización promedio de agentes',
        width: 400,
        height: 300
      };

      var piechart = new google.visualization.PieChart(document.getElementById('piechart_div'));

      piechart.draw(datapie, piechart_options);

      var databar = new google.visualization.DataTable();
      databar.addColumn('string', 'Topping');
      databar.addColumn('number', 'Slices');
      if (simulationResults && typeof simulationResults !== "undefined") {
        databar.addRows([
          ['Atención', simulationResults.avgWaitingTime * 60],
          ['Pasajero\nen el sistema', simulationResults.avgTimeInSystem],
        ]);
      } else {
        databar.addRows([
          ['Atención', 0],
          ['En sistema', 0],
        ]);
      }

      var barchart_options = {
        title: 'Tiempos promedios (minutos)',
        width: 400,
        height: 300,
        legend: 'none'
      };
      var barchart = new google.visualization.BarChart(document.getElementById('barchart_div'));
      barchart.draw(databar, barchart_options);
    };

    var save = function () {

    };

    var eliminate = function (id) {
      swal({
        title: "Confirmación",
        text: "Una vez eliminado el registro no se podrá recuperar. ¿Seguro que desea eliminarlo?",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        cancelButtonText: "No",
        confirmButtonText: "Sí",
        closeOnConfirm: false,
        closeOnCancel: true
      }).then(isConfirm => {
        if (isConfirm) {
          swal(
            "\u00C9xito",
            "Escenario eliminado correctamente",
            "success");
        }
      });
    };

    var seeDetails = function (id) {
      $("#modalDtl").modal("show");
    };

    var selectCase = function (id) {
      var idnew = "#" + id

      //Esta parte es para cambiar el ícono
      if ($(idnew).children().attr("class") == "glyphicon glyphicon-eye-open") {

        $(idnew).children().removeClass('glyphicon glyphicon-eye-open').addClass('glyphicon glyphicon-eye-close');

      } else if ($(idnew).children().attr("class") == "glyphicon glyphicon-eye-close") {

        $(idnew).children().removeClass('glyphicon glyphicon-eye-close').addClass('glyphicon glyphicon-eye-open');

      };
    };

    var seeChanges = function () {
      swal({
        title: "Se est\u00E1 actualizando la página, por favor espere.",
        type: "warning",
        html: true,
        showConfirmButton: false
      });
    };

    var main = function () {
      $("#divResult").hide();
      $("#divrecomendation").hide();
      showModalWelcome();
      google.charts.load('current', { 'packages': ['corechart'] });
      google.charts.setOnLoadCallback(drawChart);
    };

    $(document).ready(main);
  </script>
}